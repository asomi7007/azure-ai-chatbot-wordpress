# Azure AI Chatbot for WordPress

Azure AI Foundry의 강력한 AI 에이전트를 WordPress 웹사이트에 쉽게 통합하는 플러그인입니다.

[![Version](https://img.shields.io/badge/version-2.2.4-blue.svg)](https://github.com/asomi7007/azure-ai-chatbot-wordpress/releases/latest)
[![WordPress](https://img.shields.io/badge/wordpress-6.0%2B-blue.svg)](https://wordpress.org/)
[![PHP](https://img.shields.io/badge/php-7.4%2B-purple.svg)](https://www.php.net/)
[![License](https://img.shields.io/badge/license-GPL--2.0%2B-green.svg)](LICENSE)
[![GitHub Release](https://img.shields.io/github/v/release/asomi7007/azure-ai-chatbot-wordpress)](https://github.com/asomi7007/azure-ai-chatbot-wordpress/releases/latest)

## 🎉 최신 버전

### v2.2.4 (2025-10-05) - 🐛 Chat 모드 HTTP 404 오류 수정
**수정 사항:**
- Chat 모드에서 발생하던 HTTP 404 오류 완전 수정
- API 버전 초기화 로직 개선 (Agent 모드: v1, Chat 모드: 2024-08-01-preview)
- 다중 제공자별 API 엔드포인트 및 인증 방식 최적화

[릴리즈 노트](https://github.com/asomi7007/azure-ai-chatbot-wordpress/releases/tag/v2.2.4) | [다운로드](https://github.com/asomi7007/azure-ai-chatbot-wordpress/releases/download/v2.2.4/azure-ai-chatbot-wordpress.zip)

---

### v2.2.3 (2025-10-05) - 📖 버전 기록 상세화
**개선 사항:**
- README.md 버전 기록을 상세하게 업데이트
- 각 버전별 주요 기능 및 수정 사항 명시
- FAQ 섹션 대폭 강화 (AI 서비스 지원, 모드 차이, 보안 등)
- 향후 계획 현실화

[릴리즈 노트](https://github.com/asomi7007/azure-ai-chatbot-wordpress/releases/tag/v2.2.3) | [다운로드](https://github.com/asomi7007/azure-ai-chatbot-wordpress/releases/download/v2.2.3/azure-ai-chatbot-wordpress.zip)

---

### v2.2.2 (2025-10-05) - 📚 문서 개선
**변경 사항:**
- Plugin URI를 GitHub 저장소 링크로 업데이트
- README.md에 버전 배지 및 릴리즈 링크 추가
- readme.txt에 전체 변경 이력 추가

[릴리즈 노트](https://github.com/asomi7007/azure-ai-chatbot-wordpress/releases/tag/v2.2.2) | [다운로드](https://github.com/asomi7007/azure-ai-chatbot-wordpress/releases/download/v2.2.2/azure-ai-chatbot-wordpress.zip)

---

### v2.2.1 (2025-10-05) - 🐛 Hotfix
**수정 사항:**
- 엔드포인트 입력 시 trailing slash 자동 제거 (blur 이벤트)
- 실시간 입력 검증으로 404 에러 사전 방지

**문제 해결:** Azure Portal에서 복사한 엔드포인트 끝의 `/` 자동 제거

[릴리즈 노트](https://github.com/asomi7007/azure-ai-chatbot-wordpress/releases/tag/v2.2.1) | [다운로드](https://github.com/asomi7007/azure-ai-chatbot-wordpress/releases/download/v2.2.1/azure-ai-chatbot-wordpress.zip)

---

### v2.2.0 (2025-10-05) - 🌐 다중 AI 제공자 지원
**새로운 기능:**
- ✨ 6개 AI 제공자 지원: Azure OpenAI, OpenAI, Google Gemini, Anthropic Claude, xAI Grok, 기타 (OpenAI 호환)
- 🎨 동적 UI: 제공자 선택 시 엔드포인트/모델명/API Key 설명 자동 변경
- 🧪 Agent 모드 테스트 스크립트 (Service Principal 자동 생성 포함)
- 💬 모드별 오류 메시지 (Chat/Agent 구분)

**수정 사항:**
- 🐛 Trailing slash 3중 제거 (로드/저장/생성자)
- 🎨 설정 UI 개선 (테스트 결과 위치, 미리보기 통합, 저장 버튼)

[릴리즈 노트](https://github.com/asomi7007/azure-ai-chatbot-wordpress/releases/tag/v2.2.0) | [다운로드](https://github.com/asomi7007/azure-ai-chatbot-wordpress/releases/download/v2.2.0/azure-ai-chatbot-wordpress.zip)

---

### v2.1.0 (2025-10-05) - 🎯 듀얼 모드 지원
**새로운 기능:**
- ✨ Chat 모드 + Agent 모드 듀얼 지원
- 🤖 Azure AI Foundry Assistants API v1 완벽 통합
- 🔐 Entra ID OAuth 2.0 Client Credentials 인증
- 🧵 Thread 관리 및 대화 컨텍스트 자동 유지
- ⚡ 적응형 폴링 (250ms → 1000ms)
- 🧪 연결 테스트 및 자동 설정 스크립트
- 🔒 AES-256 Client Secret 암호화
- 📝 API Key/Client Secret 표시/숨김 토글

**테스트 도구:**
- `test-chat-mode.sh`: Chat 모드 Azure CLI 테스트
- `test-agent-mode.sh`: Agent 모드 SP 자동 생성 및 테스트

[릴리즈 노트](https://github.com/asomi7007/azure-ai-chatbot-wordpress/releases/tag/v2.1.0) | [다운로드](https://github.com/asomi7007/azure-ai-chatbot-wordpress/releases/download/v2.1.0/azure-ai-chatbot-wordpress.zip)

---

### v2.0.0 (2025-10-04) - 🎨 완전한 리뉴얼
**새로운 기능:**
- 관리자 페이지에서 모든 설정 가능
- AES-256 API Key 암호화
- 색상 및 위젯 위치 커스터마이징
- Azure AI 연결 테스트 기능
- 편집 가능한 마크다운 가이드
- 실시간 위젯 미리보기

---

### v1.0.0 (2025-10-03) - 🎉 초기 릴리즈
**기본 기능:**
- Azure AI Foundry 에이전트 통합
- 기본 채팅 위젯
- wp-config.php 기반 설정

## ✨ 주요 기능

### 🎯 듀얼 모드 지원
- **Chat 모드**: Azure OpenAI, OpenAI, Google Gemini, Anthropic Claude, xAI Grok 지원 (API Key 인증)
- **Agent 모드**: Azure AI Foundry Assistants API (Entra ID OAuth 2.0 인증)

### 🚀 기능
- ✅ **쉬운 설정**: wp-config.php 수정 없이 관리자 페이지에서 모든 설정
- 🎨 **완전한 커스터마이징**: 색상, 위치, 메시지 자유롭게 변경
- 🤖 **Azure AI 완벽 지원**: Function Calling, RAG, 파일 업로드 등
- 📱 **반응형 디자인**: 데스크톱과 모바일 완벽 지원
- 🔒 **보안**: API Key/Client Secret은 AES-256으로 암호화되어 서버에 저장
- 📖 **마크다운 가이드**: 편집 가능한 상세 가이드 제공
- 🧪 **연결 테스트**: 설정 페이지에서 즉시 테스트 가능
- 🛠️ **테스트 스크립트**: Chat/Agent 모드 자동 테스트 도구 포함

## 📦 설치 방법

### ZIP 파일로 설치 (권장) ⭐

가장 쉽고 빠른 설치 방법입니다!

1. **[GitHub Releases](https://github.com/asomi7007/azure-ai-chatbot-wordpress/releases/latest)에서 최신 `azure-ai-chatbot-wordpress.zip` 다운로드**
2. WordPress 관리자 페이지 접속
3. **플러그인** → **새로 추가** → **플러그인 업로드** 클릭
4. 다운로드한 ZIP 파일 선택
5. **지금 설치** 클릭
6. 설치 완료 후 **플러그인 활성화** 클릭

> 💡 **Tip**: ZIP 파일 압축을 풀 필요 없습니다! 그대로 업로드하세요.

### 수동 설치 (개발자용)

소스 코드를 직접 편집하려는 경우:

1. 이 저장소를 다운로드하거나 복제
   ```bash
   git clone https://github.com/asomi7007/azure-ai-chatbot-wordpress.git
   ```
2. 폴더를 `/wp-content/plugins/` 디렉토리에 업로드
3. WordPress 관리자 페이지에서 플러그인 활성화

### WordPress.org에서 설치 (향후 지원 예정)

1. WordPress 관리자 페이지 → **플러그인** → **새로 추가**
2. "Azure AI Chatbot" 검색
3. **지금 설치** → **활성화**

## 🚀 빠른 시작

### 방법 1: Chat 모드 (간단 - 권장) ⭐

Chat 모드는 API Key만으로 즉시 사용 가능합니다!

#### 📋 Azure Cloud Shell에서 대화형 테스트 (권장) ⭐

Azure Cloud Shell ([shell.azure.com](https://shell.azure.com))에서 **한 줄 명령**으로 실행:

```bash
curl -sL https://raw.githubusercontent.com/asomi7007/azure-ai-chatbot-wordpress/main/test-chat-mode.sh | bash
```

**대화형으로 진행됩니다:**
1. 📋 Azure 구독 선택 (여러 개인 경우)
2. 📦 Azure OpenAI 리소스 선택
3. 📊 배포된 모델 선택
4. 🔐 자동으로 엔드포인트/API Key 가져오기
5. 🧪 연결 테스트 실행
6. ✅ WordPress 설정값 출력

---

#### 📝 수동으로 설정값 확인 (선택사항)

Azure Cloud Shell에서 직접 명령어 실행:

```bash
# 구독 목록 보기
az account list --query "[].{Name:name, ID:id}" -o table

# 특정 구독 선택
az account set --subscription "your-subscription-name"

# OpenAI 리소스 목록 보기
az cognitiveservices account list --query "[?kind=='OpenAI'].{Name:name, RG:resourceGroup, Location:location}" -o table

# 엔드포인트 확인
az cognitiveservices account show \
  --name "your-resource-name" \
  --resource-group "your-rg" \
  --query "properties.endpoint" -o tsv

# API Key 확인
az cognitiveservices account keys list \
  --name "your-resource-name" \
  --resource-group "your-rg" \
  --query "key1" -o tsv

# 배포된 모델 확인
az cognitiveservices account deployment list \
  --name "your-resource-name" \
  --resource-group "your-rg" \
  --query "[].{Name:name, Model:properties.model.name}" -o table
```

#### WordPress 플러그인 설정

위 스크립트 결과에서 나온 값을 그대로 WordPress 관리자 페이지에 입력하세요:

1. WordPress 관리자 → **Azure AI Chatbot** → **설정**
2. **작동 모드**: `Chat 모드 (OpenAI 호환)` 선택
3. 스크립트 결과에서 나온 값 입력
4. **저장** 버튼 클릭
5. **연결 테스트** 버튼으로 확인

---

### 방법 2: Agent 모드 (고급 기능) 🤖

Agent 모드는 Azure AI Foundry의 **Assistants API v1**을 사용하여 다음 고급 기능을 제공합니다:

**✨ Agent 모드 주요 기능:**
- 🧵 **Thread 관리**: 대화 컨텍스트 자동 유지 (재방문 시 이전 대화 기억)
- 🛠️ **Function Calling**: 외부 API 호출, 데이터베이스 조회 등 확장 가능
- 📎 **파일 업로드**: 문서 분석 및 RAG (Retrieval-Augmented Generation)
- 🔄 **비동기 Run**: 장시간 실행 작업 지원
- 📊 **상태 추적**: 실시간 Run 상태 모니터링 (queued → in_progress → completed)

**⚠️ 중요: API 버전**
- Azure AI Foundry Assistants API는 **`api-version=v1`만 지원**됩니다
- `2024-12-01-preview` 등 날짜 기반 버전은 Sweden Central 등 일부 리전에서 작동하지 않습니다
- 본 플러그인은 `v1`을 사용하여 모든 리전에서 호환됩니다

#### 📋 Azure Cloud Shell에서 대화형 테스트 (권장) ⭐

Azure Cloud Shell ([shell.azure.com](https://shell.azure.com))에서 **한 줄 명령**으로 실행:

```bash
curl -sL https://raw.githubusercontent.com/asomi7007/azure-ai-chatbot-wordpress/main/test-agent-mode.sh | bash
```

**자동으로 처리됩니다:**
1. 📋 Azure 구독 선택 (여러 개인 경우)
2. 🏢 AI Foundry 리소스 선택
3. 🔐 **Service Principal 자동 생성/확인**
   - 기존 SP 있으면 재사용
   - 없으면 새로 생성
   - **Client Secret 자동 생성**
   - **권한 자동 부여** (Cognitive Services User)
4. 🤖 Agent 자동 선택 또는 생성
5. 🧪 완전한 연결 테스트 (Thread → Message → Run)
6. ✅ **WordPress 설정값 5개 모두 출력**:
   - Agent 엔드포인트
   - Agent ID
   - Client ID
   - Client Secret
   - Tenant ID

---

#### 📝 수동 설정 스크립트 (선택사항)

더 세밀한 제어가 필요한 경우:

**⚡ 복사 → 붙여넣기 → 실행:**

```bash
cat > setup_azure_agent.sh << 'EOFSCRIPT'
#!/bin/bash
set -e

# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# 🚀 Azure AI Chatbot WordPress - Agent 모드 자동 설정
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

echo ""
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "📋 Azure AI 프로젝트 정보 입력"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo ""

# 사용자 입력
read -p "Resource Group 이름: " RESOURCE_GROUP
read -p "AI Foundry 리소스 이름: " ACCOUNT_NAME
read -p "프로젝트 이름 (리소스와 동일하면 엔터): " PROJECT_NAME
PROJECT_NAME=${PROJECT_NAME:-$ACCOUNT_NAME}
read -p "Service Principal 이름 (기본: azure-ai-chatbot-wp): " SP_NAME
SP_NAME=${SP_NAME:-"azure-ai-chatbot-wp"}

echo ""
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "� Azure 구독 정보 확인 중..."
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"

SUBSCRIPTION_ID=$(az account show --query "id" -o tsv)
TENANT_ID=$(az account show --query "tenantId" -o tsv)
RESOURCE_ID="/subscriptions/$SUBSCRIPTION_ID/resourceGroups/$RESOURCE_GROUP/providers/Microsoft.CognitiveServices/accounts/$ACCOUNT_NAME"

echo "✅ Subscription ID: $SUBSCRIPTION_ID"
echo "✅ Tenant ID: $TENANT_ID"
echo ""

echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "🔐 Service Principal 생성 중..."
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"

# Service Principal 생성 시도
SP_OUTPUT=$(az ad sp create-for-rbac \
  --name "$SP_NAME" \
  --role "Cognitive Services User" \
  --scopes "$RESOURCE_ID" \
  2>&1)

if echo "$SP_OUTPUT" | grep -q "appId"; then
    echo "✅ Service Principal 생성 완료!"
    CLIENT_ID=$(echo $SP_OUTPUT | jq -r '.appId')
    CLIENT_SECRET=$(echo $SP_OUTPUT | jq -r '.password')
else
    echo "⚠️  이미 존재하는 Service Principal입니다."
    echo "   새 Client Secret을 생성합니다..."
    
    APP_ID=$(az ad sp list --display-name "$SP_NAME" --query "[0].appId" -o tsv)
    if [ -z "$APP_ID" ]; then
        echo "❌ Service Principal을 찾을 수 없습니다."
        echo "   다른 이름으로 다시 시도하거나 Azure Portal에서 수동으로 생성하세요."
        exit 1
    fi
    
    SP_OUTPUT=$(az ad app credential reset --id "$APP_ID" --append --years 1)
    CLIENT_ID=$APP_ID
    CLIENT_SECRET=$(echo $SP_OUTPUT | jq -r '.password')
    echo "✅ Client Secret 재생성 완료!"
fi

AGENT_ENDPOINT="https://${ACCOUNT_NAME}.services.ai.azure.com/api/projects/${PROJECT_NAME}"

echo ""
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "🤖 AI Agent 확인 중..."
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"

# Token 생성
TOKEN=$(curl -s -X POST "https://login.microsoftonline.com/$TENANT_ID/oauth2/v2.0/token" \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "client_id=$CLIENT_ID" \
  -d "client_secret=$CLIENT_SECRET" \
  -d "scope=https://ai.azure.com/.default" \
  -d "grant_type=client_credentials" | jq -r '.access_token')

if [ "$TOKEN" == "null" ] || [ -z "$TOKEN" ]; then
    echo "⚠️  토큰 생성 실패. 권한 설정 중일 수 있습니다."
    echo "   1-2분 후 다시 시도하거나 Agent ID를 수동으로 입력하세요."
    AGENT_ID="[AI Foundry에서 확인 필요]"
else
    # Assistants 목록 조회 (v1 API 사용)
    ASSISTANTS=$(curl -s \
      "${AGENT_ENDPOINT}/assistants?api-version=v1" \
      -H "Authorization: Bearer $TOKEN")
    
    AGENT_COUNT=$(echo $ASSISTANTS | jq -r '.data | length' 2>/dev/null || echo "0")
    
    if [ "$AGENT_COUNT" == "0" ]; then
        echo ""
        echo "❌ Agent가 존재하지 않습니다!"
        echo ""
        echo "다음 방법 중 하나를 선택하세요:"
        echo ""
        echo "1️⃣  AI Foundry Portal에서 생성 (권장)"
        echo "   https://ai.azure.com → Agents → Create"
        echo ""
        echo "2️⃣  Azure Cloud Shell에서 생성:"
        echo ""
        read -p "   지금 생성하시겠습니까? (y/n): " CREATE_AGENT
        
        if [ "$CREATE_AGENT" == "y" ]; then
            read -p "   Agent 이름: " AGENT_NAME
            read -p "   Agent 설명 (옵션): " AGENT_DESC
            read -p "   사용할 모델 (기본: gpt-4o): " AGENT_MODEL
            AGENT_MODEL=${AGENT_MODEL:-"gpt-4o"}
            
            NEW_AGENT=$(curl -s -X POST \
              "${AGENT_ENDPOINT}/assistants?api-version=v1" \
              -H "Authorization: Bearer $TOKEN" \
              -H "Content-Type: application/json" \
              -d "{\"model\":\"$AGENT_MODEL\",\"name\":\"$AGENT_NAME\",\"description\":\"$AGENT_DESC\",\"instructions\":\"당신은 친절한 AI 도우미입니다.\"}")
            
            AGENT_ID=$(echo $NEW_AGENT | jq -r '.id')
            echo "✅ Agent 생성 완료: $AGENT_ID"
        else
            AGENT_ID="[나중에 AI Foundry에서 생성 후 입력]"
        fi
    else
        echo "✅ $AGENT_COUNT 개의 Agent 발견!"
        echo ""
        echo "사용 가능한 Agents:"
        echo $ASSISTANTS | jq -r '.data[] | "  - \(.id): \(.name // "Unnamed")"'
        echo ""
        
        if [ "$AGENT_COUNT" == "1" ]; then
            AGENT_ID=$(echo $ASSISTANTS | jq -r '.data[0].id')
            AGENT_NAME=$(echo $ASSISTANTS | jq -r '.data[0].name // "Unnamed"')
            echo "✅ 자동 선택: $AGENT_ID ($AGENT_NAME)"
        else
            read -p "사용할 Agent ID를 입력하세요: " AGENT_ID
        fi
    fi
fi

echo ""
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "✅ 설정 완료!"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo ""
echo "📋 WordPress에 아래 값을 복사하여 입력하세요:"
echo ""
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "Agent 엔드포인트:"
echo "$AGENT_ENDPOINT"
echo ""
echo "Agent ID:"
echo "$AGENT_ID"
echo ""
echo "Client ID:"
echo "$CLIENT_ID"
echo ""
echo "Client Secret:"
echo "$CLIENT_SECRET"
echo ""
echo "Tenant ID:"
echo "$TENANT_ID"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo ""
echo "⚠️  중요: Client Secret은 지금만 표시됩니다!"
echo "         안전한 곳에 즉시 저장하세요!"
echo ""
EOFSCRIPT

chmod +x setup_azure_agent.sh
./setup_azure_agent.sh
```

**� 사용 방법:**
1. Azure Cloud Shell (https://shell.azure.com) 접속
2. 위 전체 코드 블록 복사
3. Cloud Shell에 붙여넣기
4. 프롬프트에 따라 정보 입력
5. 출력된 값들을 WordPress 설정에 입력

**📋 출력 예시:**

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Agent 엔드포인트:
https://your-resource.services.ai.azure.com/api/projects/your-project

Agent ID:
asst_xxxxxxxxxxxxxxxxxxxxxx

Client ID:
xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx

Client Secret:
xxx~xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

Tenant ID:
xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

#### 개별 명령어로 설정 (선택사항)

스크립트를 사용하지 않는 경우 개별 명령어:

```bash
# 1. Service Principal 생성
az ad sp create-for-rbac \
  --name "azure-ai-chatbot-wordpress" \
  --role "Cognitive Services User" \
  --scopes "/subscriptions/{SUBSCRIPTION_ID}/resourceGroups/{RG}/providers/Microsoft.CognitiveServices/accounts/{ACCOUNT}"

# 2. 출력에서 다음 정보 복사:
# - appId → Client ID
# - password → Client Secret
# - tenant → Tenant ID

# 3. Agent ID는 Azure AI Foundry (https://ai.azure.com)에서 확인
```

#### Client Secret 재생성 (분실 시)

```bash
# 기존 Service Principal의 새 Client Secret 생성
az ad app credential reset \
  --id "{CLIENT_ID}" \
  --append \
  --years 1

# 출력된 password를 WordPress에 입력
```

---

### 1단계: Azure AI Foundry 정보 확인 (레거시)

Azure Portal에서 다음 정보를 확인하세요:

- **API Key**: AI Foundry 리소스 → "키 및 엔드포인트"
- **프로젝트 엔드포인트**: `https://[리소스명].services.ai.azure.com/api/projects/[프로젝트명]`
- **에이전트 ID**: AI Foundry에서 생성한 에이전트 ID (예: `asst_xxxxx`)

### 2단계: 플러그인 설정

1. WordPress 관리자 → **AI Chatbot** → **설정**
2. Azure 정보 입력
3. **위젯 활성화** 체크
4. **설정 저장**

### 3단계: 테스트

- **연결 테스트** 버튼으로 Azure 연결 확인
- 웹사이트 방문하여 채팅 버튼 확인

## 📁 파일 구조

```
azure-ai-chatbot/
├── azure-ai-chatbot.php      # 메인 플러그인 파일
├── README.md                  # 이 파일
├── assets/                    # CSS/JS 리소스
│   ├── chatbot.css           # 프론트엔드 스타일
│   ├── chatbot.js            # 프론트엔드 스크립트
│   ├── admin.css             # 관리자 스타일
│   └── admin.js              # 관리자 스크립트
├── templates/                 # PHP 템플릿
│   ├── settings-page.php     # 설정 페이지
│   └── guide-page.php        # 가이드 페이지
└── docs/                      # 문서
    └── USER_GUIDE.md         # 사용자 가이드 (편집 가능)
```

## ⚙️ 설정 옵션

### Azure 연결

| 설정 | 설명 | 필수 |
|------|------|------|
| API Key | Azure AI API 키 | ✅ |
| 프로젝트 엔드포인트 | Azure AI 프로젝트 URL | ✅ |
| 에이전트 ID | 사용할 에이전트 ID | ✅ |

### 위젯 설정

| 설정 | 설명 | 기본값 |
|------|------|--------|
| 위젯 활성화 | 채팅 위젯 표시 여부 | 비활성화 |
| 위젯 위치 | 버튼 위치 (오른쪽/왼쪽 하단) | 오른쪽 하단 |
| 채팅 제목 | 채팅창 제목 | "AI 도우미" |
| 환영 메시지 | 첫 메시지 | "안녕하세요! ..." |

### 디자인

| 설정 | 설명 | 기본값 |
|------|------|--------|
| 주 색상 | 버튼 및 사용자 메시지 색상 | #667eea |
| 보조 색상 | 그라데이션 두 번째 색상 | #764ba2 |

## 🎨 커스터마이징

### CSS 커스터마이징

테마의 `style.css`에 추가:

```css
/* 채팅 버튼 크기 */
.chatbot-toggle {
    width: 70px !important;
    height: 70px !important;
}

/* 채팅창 크기 */
.chatbot-window {
    width: 400px !important;
    height: 650px !important;
}
```

### Function Calling 추가

`functions.php`에 추가:

```php
add_filter('azure_chatbot_function_call', function($result, $function_name, $arguments) {
    if ($function_name === 'my_custom_function') {
        // 커스텀 로직
        return ['result' => 'success'];
    }
    return $result;
}, 10, 3);
```

## 🔧 개발자 가이드

### 훅 (Hooks)

**필터:**
- `azure_chatbot_function_call` - Function calling 처리
- `azure_chatbot_before_send` - 메시지 전송 전
- `azure_chatbot_response_format` - 응답 포맷 변경

**액션:**
- `azure_chatbot_after_response` - 응답 받은 후
- `azure_chatbot_widget_loaded` - 위젯 로드 완료

### API 엔드포인트

```
POST /wp-json/azure-chatbot/v1/chat
```

**요청 본문:**
```json
{
    "message": "사용자 메시지",
    "thread_id": "thread_xxxxx" (선택)
}
```

**응답:**
```json
{
    "success": true,
    "reply": "AI 응답",
    "thread_id": "thread_xxxxx"
}
```

## 📊 시스템 요구사항

- **WordPress**: 6.0 이상
- **PHP**: 7.4 이상
- **Azure 구독**: Active Azure subscription
- **메모리**: 최소 128MB PHP memory limit
- **SSL**: HTTPS 권장 (API 보안)

## 🐛 문제 해결

### 채팅 버튼이 보이지 않음

1. **설정** → **위젯 활성화** 체크 확인
2. API Key, 엔드포인트, 에이전트 ID 모두 입력 확인
3. 브라우저 캐시 삭제 및 새로고침

### API 오류 발생

1. Azure Portal에서 API Key 재확인
2. **연결 테스트** 버튼으로 진단
3. `/wp-content/debug.log` 확인

### 디버그 모드 활성화

`wp-config.php`에 추가:

```php
define('WP_DEBUG', true);
define('WP_DEBUG_LOG', true);
define('WP_DEBUG_DISPLAY', false);
```

## 💰 비용 안내

### Azure AI Foundry 가격 (2025년 기준)

**GPT-4o 모델:**
- 입력: $2.50 per 1M tokens
- 출력: $10.00 per 1M tokens

**예상 비용:**
- 월 1,000건 대화 (평균 500토큰) ≈ $3-5
- 월 10,000건 대화 ≈ $30-50

자세한 요금: [Azure 가격 계산기](https://azure.microsoft.com/pricing/calculator/)

## 🔐 보안 고려사항

### API Key 암호화 저장

**중요**: 이 플러그인은 API Key를 평문으로 저장하지 않습니다!

#### 암호화 상세
- **알고리즘**: AES-256-CBC
- **키 생성**: WordPress 보안 상수 조합 (SHA-256 해시)
- **IV**: 랜덤 생성 (매번 다름)
- **요구사항**: OpenSSL PHP 확장 (대부분의 서버에 기본 설치)

#### 자동 보안 키 생성 ✨

**플러그인 활성화 시 자동으로:**

1. `wp-config.php`의 보안 키 확인
2. 보안 키가 없거나 기본값(`put your unique phrase here`)이면:
   - WordPress.org API에서 새 보안 키 자동 생성
   - `wp-config.php`에 자동 추가/업데이트
   - 기존 파일 백업 (`wp-config.php.backup-YYYYMMDD-HHMMSS`)
   - 성공 여부를 관리자 화면에 알림
3. 파일 쓰기 권한이 없으면 수동 설정 안내

**성공 시 표시:**
```
✅ WordPress 보안 키가 자동으로 생성되어 wp-config.php에 추가되었습니다!
백업 파일: wp-config.php.backup-2025-01-15-143022
```

**수동 설정 (필요 시):**
```php
// wp-config.php에 추가
define('AUTH_KEY', 'your-unique-phrase');
define('SECURE_AUTH_KEY', 'your-unique-phrase');
define('LOGGED_IN_KEY', 'your-unique-phrase');
define('NONCE_KEY', 'your-unique-phrase');
define('AUTH_SALT', 'your-unique-phrase');
define('SECURE_AUTH_SALT', 'your-unique-phrase');
define('LOGGED_IN_SALT', 'your-unique-phrase');
define('NONCE_SALT', 'your-unique-phrase');
```

보안 키 생성: https://api.wordpress.org/secret-key/1.1/salt/

### 보안 기능

- ✅ **AES-256 암호화**: API Key 데이터베이스 암호화
- ✅ **API Key 마스킹**: 설정 페이지에서 전체 키 숨김 (예: ab12••••••••xy89)
- ✅ **서버 사이드 처리**: API Key는 서버에서만 사용, 클라이언트 노출 없음
- ✅ **WordPress Nonce**: CSRF 공격 방어
- ✅ **입력 검증**: 모든 입력 sanitization
- ✅ **권한 확인**: 관리자만 설정 변경 가능
- ❌ **Rate Limiting**: 향후 업데이트 예정

### 보안 권장사항

1. **HTTPS 사용**: SSL 인증서 필수
2. **WordPress 업데이트**: 최신 버전 유지
3. **강력한 비밀번호**: 관리자 계정 보안
4. **2FA 활성화**: 2단계 인증 사용
5. **정기 백업**: 데이터베이스 및 파일 백업
6. **보안 플러그인**: Wordfence, iThemes Security 등 사용

## 📈 성능 최적화

### 권장 설정

1. **캐싱 플러그인 사용**: WP Rocket, W3 Total Cache
2. **CDN 활용**: Cloudflare, Amazon CloudFront
3. **이미지 최적화**: Imagify, ShortPixel
4. **데이터베이스 최적화**: WP-Optimize

### 속도 개선 팁

- Thread ID를 로컬 스토리지에 저장하여 불필요한 생성 방지
- 에이전트 프롬프트를 간결하게 유지
- Function calling 응답 캐싱 고려

## 🌍 다국어 지원

현재 한국어로 제공되며, 향후 영어 등 추가 언어를 지원할 예정입니다.

### 번역 기여

번역에 참여하고 싶으신가요?
- `.pot` 파일: `languages/azure-ai-chatbot.pot`
- 연락처: admin@eldensolution.kr

## 🤝 기여하기

### 버그 리포트

다음 정보와 함께 이메일 보내주세요:
- WordPress 버전
- PHP 버전
- 플러그인 버전
- 오류 메시지
- 재현 단계

**연락처**: admin@eldensolution.kr

### 기능 제안

새 기능 아이디어가 있으신가요?
- 이메일: admin@eldensolution.kr
- 제목: [Feature Request] 기능 제목

### 코드 기여

1. Fork this repository
2. Create your feature branch: `git checkout -b feature/AmazingFeature`
3. Commit your changes: `git commit -m 'Add some AmazingFeature'`
4. Push to the branch: `git push origin feature/AmazingFeature`
5. Open a Pull Request

## 📝 변경 로그

### 2.0.0 (2025-01-XX)

**추가:**
- ✨ 관리자 페이지에서 모든 설정 가능
- ✨ 마크다운 가이드 편집 기능
- ✨ 색상 및 위치 커스터마이징
- ✨ 연결 테스트 기능
- ✨ Function calling 확장 포인트

**개선:**
- 🎨 향상된 UI/UX
- 🔒 보안 강화 (Nonce 검증)
- 📱 모바일 반응형 개선
- ⚡ 성능 최적화

**수정:**
- 🐛 Thread ID 저장 버그 수정
- 🐛 색상 선택기 버그 수정

### 1.0.0 (초기 릴리스)
- 기본 채팅 기능
- Azure AI Foundry 연동

## 📚 추가 리소스

### 공식 문서
- [Azure AI Foundry](https://learn.microsoft.com/azure/ai-foundry/)
- [WordPress Plugin Handbook](https://developer.wordpress.org/plugins/)

### 튜토리얼
- [Azure AI Agent 생성하기](https://ai.azure.com)
- [Function Calling 가이드](https://learn.microsoft.com/azure/ai-foundry/agents/)

### 커뮤니티
- **이메일 지원**: admin@eldensolution.kr
- **웹사이트**: https://www.eldensolution.kr

## 📄 라이선스

이 프로젝트는 GPL-2.0+ 라이선스 하에 배포됩니다.

```
Copyright (C) 2025 Elden Solution (엘던솔루션)

This program is free software; you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation; either version 2 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program; if not, write to the Free Software
Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA
```

## 👤 제작자

**엘던솔루션 (Elden Solution)**
- 웹사이트: https://www.eldensolution.kr
- 이메일: admin@eldensolution.kr
- 위치: 대한민국

## 🙏 감사의 말

이 플러그인을 만드는 데 도움을 주신 분들:
- Microsoft Azure AI 팀
- WordPress 커뮤니티
- 모든 베타 테스터분들

Developed with ❤️ by [Elden Solution](https://www.eldensolution.kr)

## 💡 향후 계획

### v2.3.0 (예정)
- [ ] 실시간 스트리밍 응답 (Server-Sent Events)
- [ ] 대화 내역 대시보드
- [ ] 파일 업로드 지원 (이미지, PDF)
- [ ] 음성 입력/출력 (Speech-to-Text, Text-to-Speech)

### v2.4.0 (예정)
- [ ] 완전한 다국어 지원 (영어, 일본어, 중국어 등)
- [ ] 고급 분석 대시보드 (대화 통계, 사용자 패턴)
- [ ] A/B 테스트 기능
- [ ] 화이트라벨 옵션

### v3.0.0 (장기)
- [ ] AI 학습 데이터 관리 (Fine-tuning)
- [ ] 멀티사이트 지원
- [ ] REST API 확장
- [ ] Webhook 통합
- [ ] 다중 에이전트 동시 실행

## ❓ FAQ

**Q: 무료인가요?**  
A: 플러그인은 무료 오픈소스이지만, AI 서비스 사용료(Azure OpenAI, OpenAI 등)는 별도로 발생합니다.

**Q: 어떤 AI 서비스를 지원하나요?**  
A: **Chat 모드**에서는 Azure OpenAI, OpenAI, Google Gemini, Anthropic Claude, xAI Grok 및 OpenAI 호환 API를 모두 지원합니다. **Agent 모드**에서는 Azure AI Foundry Assistants API를 지원합니다.

**Q: Chat 모드와 Agent 모드의 차이는?**  
A: **Chat 모드**는 간단한 대화형 챗봇으로 API Key만 있으면 됩니다. **Agent 모드**는 Thread 관리, Function Calling, RAG 등 고급 기능을 제공하며 Entra ID 인증이 필요합니다.

**Q: 상업적 이용이 가능한가요?**  
A: 네, GPL-2.0+ 라이선스 하에 자유롭게 사용 가능합니다.

**Q: 업데이트는 어떻게 받나요?**  
A: [GitHub Releases](https://github.com/asomi7007/azure-ai-chatbot-wordpress/releases/latest)에서 최신 ZIP 파일을 다운로드하여 수동으로 업데이트합니다. (향후 WordPress.org 등록 시 자동 업데이트 지원 예정)

**Q: API Key는 안전한가요?**  
A: 네, AES-256 암호화로 안전하게 저장되며 서버에서만 처리됩니다. 클라이언트(브라우저)에는 노출되지 않습니다.

**Q: 기술 지원은 어떻게 받나요?**  
A: [GitHub Issues](https://github.com/asomi7007/azure-ai-chatbot-wordpress/issues)에 문의하시거나 admin@eldensolution.kr로 이메일 주세요.

**Q: 테스트 방법이 있나요?**  
A: 네, `test-chat-mode.sh`와 `test-agent-mode.sh` 스크립트로 Azure 연결을 테스트할 수 있습니다.

---

⭐ 이 플러그인이 유용하다면 GitHub에서 Star를 눌러주세요!

🐛 버그를 발견하셨나요? [Issue를 등록](https://github.com/asomi7007/azure-ai-chatbot-wordpress/issues)해주세요.

💬 질문이 있으신가요? admin@eldensolution.kr로 연락주세요.

🌐 더 많은 솔루션: [www.eldensolution.kr](https://www.eldensolution.kr)
